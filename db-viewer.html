<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AAA // DB Viewer</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;700;800;900&display=swap");

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg: #0a0a0a;
        --surface: #111;
        --surface2: #161616;
        --border: #1e1e1e;
        --border2: #2a2a2a;
        --text: #e8e8e8;
        --muted: #444;
        --muted2: #666;
        --accent: #e8ff47;
        --accent2: #ff6b35;
        --green: #4ade80;
        --red: #f87171;
        --blue: #60a5fa;
        --purple: #c084fc;
        --orange: #fb923c;
      }

      html,
      body {
        height: 100%;
        background: var(--bg);
        color: var(--text);
        font-family: "JetBrains Mono", monospace;
      }

      /* ── TOPBAR */
      .topbar {
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 0 24px;
        height: 52px;
      }
      .topbar-title {
        font-family: "Syne", sans-serif;
        font-weight: 900;
        font-size: 14px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--accent);
      }
      .topbar-sep {
        width: 1px;
        height: 20px;
        background: var(--border2);
      }

      .base-url-input {
        background: var(--bg);
        border: 1px solid var(--border2);
        color: var(--text);
        font-family: "JetBrains Mono", monospace;
        font-size: 11px;
        padding: 5px 10px;
        border-radius: 3px;
        outline: none;
        width: 200px;
      }
      .base-url-input:focus {
        border-color: #333;
      }

      .token-input {
        background: var(--bg);
        border: 1px solid var(--border2);
        color: var(--accent);
        font-family: "JetBrains Mono", monospace;
        font-size: 11px;
        padding: 5px 10px;
        border-radius: 3px;
        outline: none;
        width: 260px;
      }
      .token-input:focus {
        border-color: var(--accent);
      }
      .token-input::placeholder {
        color: var(--muted);
      }

      .token-status {
        font-size: 10px;
        padding: 3px 8px;
        border-radius: 2px;
        font-weight: 700;
      }
      .token-status.set {
        background: #1a2e1a;
        color: var(--green);
      }
      .token-status.unset {
        background: #2e1a1a;
        color: var(--red);
      }

      .refresh-btn {
        margin-left: auto;
        background: var(--accent);
        color: #000;
        border: none;
        font-family: "Syne", sans-serif;
        font-size: 11px;
        font-weight: 900;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        padding: 6px 16px;
        border-radius: 3px;
        cursor: pointer;
        transition: opacity 0.15s;
      }
      .refresh-btn:hover {
        opacity: 0.85;
      }
      .refresh-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .last-updated {
        font-size: 10px;
        color: var(--muted2);
        white-space: nowrap;
      }

      /* ── LAYOUT */
      .content {
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      /* ── TABLE CARD */
      .table-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 4px;
        overflow: hidden;
      }
      .table-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
        background: var(--surface2);
      }
      .table-card-name {
        font-family: "Syne", sans-serif;
        font-size: 12px;
        font-weight: 800;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--accent);
      }
      .table-card-count {
        font-size: 10px;
        padding: 2px 8px;
        border-radius: 2px;
        font-weight: 700;
        background: #1a1a1a;
        color: var(--muted2);
        border: 1px solid var(--border2);
      }
      .table-card-error {
        font-size: 11px;
        color: var(--red);
        margin-left: auto;
      }
      .table-card-loading {
        font-size: 11px;
        color: var(--muted2);
        margin-left: auto;
      }

      /* ── DATA TABLE */
      .data-table-wrap {
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
      }
      .data-table-wrap::-webkit-scrollbar {
        width: 4px;
        height: 4px;
      }
      .data-table-wrap::-webkit-scrollbar-thumb {
        background: var(--border2);
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
      }
      .data-table thead th {
        position: sticky;
        top: 0;
        z-index: 2;
        background: #0f0f0f;
        color: var(--muted2);
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-size: 10px;
        padding: 8px 12px;
        text-align: left;
        border-bottom: 1px solid var(--border);
        white-space: nowrap;
      }
      .data-table tbody td {
        padding: 8px 12px;
        border-bottom: 1px solid var(--border);
        color: var(--text);
        vertical-align: top;
        white-space: nowrap;
        max-width: 280px;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .data-table tbody tr:last-child td {
        border-bottom: none;
      }
      .data-table tbody tr:hover td {
        background: rgba(255, 255, 255, 0.02);
      }

      .empty-rows {
        padding: 24px;
        text-align: center;
        font-size: 11px;
        color: var(--muted);
      }

      /* value types */
      .val-null {
        color: var(--muted);
        font-style: italic;
      }
      .val-bool-t {
        color: var(--green);
      }
      .val-bool-f {
        color: var(--red);
      }
      .val-num {
        color: var(--blue);
      }
      .val-json {
        color: var(--purple);
        font-size: 10px;
      }
      .val-date {
        color: var(--orange);
      }
      .val-str {
        color: var(--text);
      }
      .val-id {
        color: var(--accent);
        font-weight: 700;
      }

      /* ── SUMMARY ROW */
      .summary-row {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 1px;
        background: var(--border);
        border-bottom: 1px solid var(--border);
      }
      .summary-cell {
        background: var(--surface2);
        padding: 10px 16px;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .summary-label {
        font-size: 9px;
        color: var(--muted2);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 700;
      }
      .summary-val {
        font-size: 20px;
        font-family: "Syne", sans-serif;
        font-weight: 900;
        color: var(--accent);
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="topbar-title">AAA // Live Data</div>
      <div class="topbar-sep"></div>
      <input
        class="base-url-input"
        id="baseUrl"
        value="http://localhost:8080"
        placeholder="base url"
      />
      <input
        class="token-input"
        id="tokenInput"
        type="text"
        placeholder="paste JWT token..."
      />
      <span class="token-status unset" id="tokenStatus">NO TOKEN</span>
      <span class="last-updated" id="lastUpdated"></span>
      <button class="refresh-btn" id="refreshBtn">↺ REFRESH</button>
    </div>

    <div class="content" id="content">
      <div
        style="
          padding: 48px;
          text-align: center;
          color: #333;
          font-family: &quot;Syne&quot;, sans-serif;
          font-size: 18px;
          font-weight: 800;
        "
      >
        paste your token and hit REFRESH
      </div>
    </div>

    <script>
      let token = "";

      const tokenInput = document.getElementById("tokenInput");
      const tokenStatus = document.getElementById("tokenStatus");
      tokenInput.addEventListener("input", () => {
        token = tokenInput.value.trim();
        tokenStatus.textContent = token ? "TOKEN SET" : "NO TOKEN";
        tokenStatus.className = `token-status ${token ? "set" : "unset"}`;
      });

      document.getElementById("refreshBtn").addEventListener("click", loadAll);

      // ── API ENDPOINTS TO SHOW
      const ENDPOINTS = [
        { name: "users", url: "/api/users", auth: true },
        { name: "members", url: "/api/members", auth: true },
        { name: "reservations", url: "/api/reservations", auth: true },
        { name: "menu_items", url: "/api/menu-items", auth: true },
        { name: "dining_rooms", url: "/api/dining-rooms", auth: true },
        { name: "tables", url: "/api/tables", auth: true },
      ];

      async function fetchEndpoint(base, endpoint) {
        const headers = { "Content-Type": "application/json" };
        if (endpoint.auth && token)
          headers["Authorization"] = `Bearer ${token}`;

        const res = await fetch(`${base}${endpoint.url}`, { headers });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        return Array.isArray(data) ? data : [data];
      }

      async function loadAll() {
        const base = document
          .getElementById("baseUrl")
          .value.trim()
          .replace(/\/$/, "");
        const btn = document.getElementById("refreshBtn");
        btn.disabled = true;
        btn.textContent = "LOADING...";

        const content = document.getElementById("content");

        // build summary + cards
        const results = await Promise.allSettled(
          ENDPOINTS.map((ep) => fetchEndpoint(base, ep)),
        );

        const counts = {};
        ENDPOINTS.forEach((ep, i) => {
          const r = results[i];
          counts[ep.name] = r.status === "fulfilled" ? r.value.length : "—";
        });

        content.innerHTML = "";

        // summary row
        const summaryRow = document.createElement("div");
        summaryRow.className = "summary-row";
        ENDPOINTS.forEach((ep) => {
          const cell = document.createElement("div");
          cell.className = "summary-cell";
          cell.innerHTML = `
      <div class="summary-label">${ep.name.replace(/_/g, " ")}</div>
      <div class="summary-val">${counts[ep.name]}</div>
    `;
          summaryRow.appendChild(cell);
        });
        content.appendChild(summaryRow);

        // table cards
        ENDPOINTS.forEach((ep, i) => {
          const result = results[i];
          const card = buildCard(ep, result);
          content.appendChild(card);
        });

        document.getElementById("lastUpdated").textContent =
          "updated " + new Date().toLocaleTimeString();

        btn.disabled = false;
        btn.textContent = "↺ REFRESH";
      }

      function buildCard(endpoint, result) {
        const card = document.createElement("div");
        card.className = "table-card";

        const header = document.createElement("div");
        header.className = "table-card-header";

        const name = document.createElement("div");
        name.className = "table-card-name";
        name.textContent = endpoint.name.replace(/_/g, " ");
        header.appendChild(name);

        if (result.status === "fulfilled") {
          const rows = result.value;
          const count = document.createElement("div");
          count.className = "table-card-count";
          count.textContent = `${rows.length} row${rows.length !== 1 ? "s" : ""}`;
          header.appendChild(count);
          card.appendChild(header);

          if (rows.length === 0) {
            const empty = document.createElement("div");
            empty.className = "empty-rows";
            empty.textContent = "no data";
            card.appendChild(empty);
          } else {
            const wrap = document.createElement("div");
            wrap.className = "data-table-wrap";
            wrap.appendChild(buildTable(rows));
            card.appendChild(wrap);
          }
        } else {
          const err = document.createElement("div");
          err.className = "table-card-error";
          err.textContent = result.reason?.message || "error";
          header.appendChild(err);
          card.appendChild(header);
        }

        return card;
      }

      function buildTable(rows) {
        const cols = Object.keys(rows[0]);
        const table = document.createElement("table");
        table.className = "data-table";

        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        cols.forEach((col) => {
          const th = document.createElement("th");
          th.textContent = col;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        rows.forEach((row) => {
          const tr = document.createElement("tr");
          cols.forEach((col) => {
            const td = document.createElement("td");
            const val = row[col];
            td.innerHTML = formatValue(col, val);
            td.title = val !== null && val !== undefined ? String(val) : "";
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        return table;
      }

      function formatValue(col, val) {
        if (val === null || val === undefined)
          return `<span class="val-null">null</span>`;
        if (col === "id" || col.endsWith("_id"))
          return `<span class="val-id">${val}</span>`;
        if (typeof val === "boolean")
          return val
            ? `<span class="val-bool-t">true</span>`
            : `<span class="val-bool-f">false</span>`;
        if (typeof val === "number")
          return `<span class="val-num">${val}</span>`;
        if (typeof val === "object")
          return `<span class="val-json">${JSON.stringify(val)}</span>`;

        const str = String(val);

        // dates/timestamps
        if (
          col.endsWith("_at") ||
          col === "date" ||
          col === "start_time" ||
          col === "end_time"
        ) {
          return `<span class="val-date">${str}</span>`;
        }

        // password hashes — mask
        if (col === "password_hash")
          return `<span class="val-null">••••••••</span>`;

        return `<span class="val-str">${str}</span>`;
      }
    </script>
  </body>
</html>
